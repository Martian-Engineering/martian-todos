{"type":"create","timestamp":"2026-01-31T22:29:00.857172Z","issue_id":"martian-todos-f34","payload":{"description":"Complete the JWT authentication implementation with proper bcrypt hashing. Add password validation rules, token refresh functionality, and logout endpoint. The scaffold has basic auth but needs hardening.","priority":"2","title":"Implement JWT auth (bcrypt, users table)","type":"task"}}
{"type":"create","timestamp":"2026-01-31T22:29:01.749773Z","issue_id":"martian-todos-74d","payload":{"description":"Complete the todos CRUD API with proper validation, error handling, and business logic. Add bulk operations (mark all complete, delete completed), sorting options, and search functionality.","priority":"2","title":"Implement todos CRUD API","type":"task"}}
{"type":"create","timestamp":"2026-01-31T22:29:02.703682Z","issue_id":"martian-todos-2ba","payload":{"description":"Complete the frontend with better styling, loading states, error boundaries, and optimistic updates. Add filtering/sorting UI, keyboard shortcuts, and responsive design.","priority":"2","title":"Implement frontend React components","type":"task"}}
{"type":"create","timestamp":"2026-01-31T22:29:03.783646Z","issue_id":"martian-todos-ba5","payload":{"description":"Enhance the migration system with versioning, rollback support, and seed data. Add a proper migration runner that tracks applied migrations in a metadata table.","priority":"2","title":"Set up PostgreSQL with migrations","type":"task"}}
{"type":"create","timestamp":"2026-01-31T22:29:04.831757Z","issue_id":"martian-todos-c32","payload":{"description":"Finish the Terraform modules for production deployment. Add ECR repositories, CI/CD pipeline with GitHub Actions, SSL certificates, and proper secrets management.","priority":"2","title":"Complete Terraform AWS deployment","type":"task"}}
{"type":"create","timestamp":"2026-01-31T22:29:05.819669Z","issue_id":"martian-todos-781","payload":{"description":"Enhance docker-compose.yml with hot-reloading for backend, volume mounts for development, and health checks. Add Redis for caching if needed.","priority":"2","title":"Set up Docker Compose for local dev","type":"task"}}
{"type":"create","timestamp":"2026-01-31T22:29:06.765666Z","issue_id":"martian-todos-e97","payload":{"description":"Add Vitest for backend unit tests and React Testing Library for frontend. Create test fixtures, mock database utilities, and CI test workflow. Target 80% coverage.","priority":"2","title":"Add unit and integration tests","type":"task"}}
{"type":"create","timestamp":"2026-01-31T22:29:07.750022Z","issue_id":"martian-todos-058","payload":{"description":"Add TODO comments, minor bugs, code smell examples, and opportunities for AI-assisted refactoring. Document these in a separate file for workshop facilitators.","priority":"2","title":"Add deliberately imperfect code for workshop demos","type":"task"}}
{"type":"status_update","timestamp":"2026-01-31T22:34:24.642214Z","issue_id":"martian-todos-f34","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-01-31T22:34:25.355158Z","issue_id":"martian-todos-74d","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-01-31T22:34:30.841433Z","issue_id":"martian-todos-781","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-01-31T22:34:32.833494Z","issue_id":"martian-todos-2ba","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-01-31T22:34:35.587916Z","issue_id":"martian-todos-058","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-01-31T22:37:33.847081Z","issue_id":"martian-todos-058","payload":{}}
{"type":"close","timestamp":"2026-01-31T22:38:03.384698Z","issue_id":"martian-todos-781","payload":{}}
{"type":"close","timestamp":"2026-01-31T22:40:07.46438Z","issue_id":"martian-todos-74d","payload":{}}
{"type":"close","timestamp":"2026-01-31T22:44:28.515141Z","issue_id":"martian-todos-f34","payload":{}}
{"type":"close","timestamp":"2026-01-31T22:47:31.787599Z","issue_id":"martian-todos-2ba","payload":{}}
{"type":"create","timestamp":"2026-02-05T22:28:28.066123Z","issue_id":"martian-todos-869","payload":{"description":"### Summary\\nPressing Esc is advertised as \"Clear search\" (shown in the UI shortcut list), but it does not clear the search input.\\n\\n### Steps to reproduce\\n1. Sign in to the app.\\n2. Focus the search input (shortcut:  per UI).\\n3. Type any search query.\\n4. Press .\\n\\n### Expected\\nSearch query clears (and/or search input blurs) per shortcut hint.\\n\\n### Actual\\nNothing happens; search remains populated.\\n\\n### Notes\\nLikely related to  keyboard shortcut handling: the handler ignores events when the target is an input/textarea/select, which would include the search textbox, preventing Esc from being handled while the search box is focused.","priority":"2","title":"Esc key does not clear search","type":"bug"}}
{"type":"update","timestamp":"2026-02-05T22:28:58.297929Z","issue_id":"martian-todos-869","payload":{"description":"### Summary\nPressing `Esc` is advertised as \"Clear search\" (shown in the UI shortcut list), but it does not clear the search input.\n\n### Steps to reproduce\n1. Sign in to the app.\n2. Focus the search input (shortcut: `/` per UI).\n3. Type any search query.\n4. Press `Esc`.\n\n### Expected\nSearch query clears (and/or search input blurs) per shortcut hint.\n\n### Actual\nNothing happens; search remains populated.\n\n### Notes\nLikely related to `apps/frontend/src/App.tsx` keyboard shortcut handling: the handler ignores events when the target is an input/textarea/select, which would include the search textbox, preventing Esc from being handled while the search box is focused."}}
{"type":"create","timestamp":"2026-02-05T22:29:37.280804Z","issue_id":"martian-todos-d24","payload":{"description":"### Summary\nClicking an issue/todo in the list should navigate to a detail view, but it currently does nothing.\n\n### Steps to reproduce\n1. Sign in.\n2. Ensure there is at least one issue/todo visible in the list.\n3. Click the issue/todo row (or title).\n\n### Expected\nApp navigates to an issue/todo detail view (URL updates and details render).\n\n### Actual\nNo navigation occurs; the list view remains.\n\n### Notes\nThe UI implies click-through is supported, but there is no working navigation to a detail route/view yet (possibly missing router/route or click handler in the list item component).","priority":"2","title":"Clicking an issue does not open detail view","type":"bug"}}
{"type":"update","timestamp":"2026-02-05T22:32:04.873855Z","issue_id":"martian-todos-d24","payload":{"description":"## Scope\n\nImplement a navigable detail view for individual todos. Clicking a todo in the list navigates to a dedicated detail page at `/todos/:id` that displays all todo fields and supports inline editing. The URL is shareable/bookmarkable.\n\n## UX\n\n- **List → Detail**: Clicking a todo title in the list navigates to `/todos/:id`. The URL updates in the browser.\n- **Detail View**: Shows all todo fields (title, description, priority, status, due date, timestamps). Provides inline editing for mutable fields (title, description, priority, status, due date). Shows a back link to return to the list.\n- **Navigation**: Browser back/forward works. Direct URL access (deep link) loads the correct todo.\n- **Error states**: 404 if the todo doesn't exist. Loading skeleton while fetching.\n\n## Non-goals\n\n- Nested routing (e.g., /todos/:id/comments)\n- Activity history or audit log on the detail view\n- Real-time updates / websocket sync\n- Rewriting the existing list view","type":"epic"}}
{"type":"status_update","timestamp":"2026-02-05T22:32:08.79036Z","issue_id":"martian-todos-d24","payload":{"status":"open"}}
{"type":"comment","timestamp":"2026-02-05T22:32:21.598374Z","issue_id":"martian-todos-d24","payload":{"body":"Converted from bug to epic. New effective title: **Todo Detail View**. See updated description for full scope, UX spec, and non-goals."}}
{"type":"create","timestamp":"2026-02-05T22:32:34.201657Z","issue_id":"martian-todos-489","payload":{"description":"## Context\nThe frontend currently has no router (`apps/frontend/package.json` shows no `react-router-dom`). The app renders a single `App.tsx` component. We need client-side routing to support URL-based navigation (`/todos/:id`).\n\n## Decision\nReact Router v6 is the standard choice for React SPAs and supports the features we need (parameterized routes, browser history, deep links). An alternative would be a state-based approach (no URL changes), but that breaks bookmarkability and shareability — a stated requirement.\n\n**Recommendation**: Install `react-router-dom` v6.\n\n## Acceptance Criteria\n- [ ] `react-router-dom` is added to `apps/frontend/package.json` dependencies\n- [ ] `apps/frontend/src/main.tsx` wraps `\u003cApp /\u003e` in `\u003cBrowserRouter\u003e`\n- [ ] `apps/frontend/src/App.tsx` defines routes: `/` (list view) and `/todos/:id` (detail view placeholder)\n- [ ] Navigating to `/` renders the existing list view unchanged\n- [ ] Navigating to `/todos/some-id` renders a placeholder component\n- [ ] Browser back/forward navigates between routes\n- [ ] Vite dev server configured to serve `index.html` for all routes (SPA fallback — likely already handled by Vite default)\n\n## Files\n- `apps/frontend/package.json` — add dependency\n- `apps/frontend/src/main.tsx` — wrap in BrowserRouter\n- `apps/frontend/src/App.tsx` — refactor to use Routes/Route","priority":"2","title":"Evaluate and add React Router","type":"task"}}
{"type":"create","timestamp":"2026-02-05T22:32:40.328727Z","issue_id":"martian-todos-7fe","payload":{"description":"## Context\nThe frontend API client (`apps/frontend/src/api/todos.ts`) has `fetchTodos`, `createTodo`, `updateTodo`, `deleteTodo` but no function to fetch a single todo. The backend already supports `GET /todos/:id` (`apps/backend/src/routes/todos.ts:119`).\n\n## Acceptance Criteria\n- [ ] New `fetchTodo(token: string, id: string): Promise\u003cTodo\u003e` function exported from `apps/frontend/src/api/todos.ts`\n- [ ] Calls `GET /api/todos/:id` using the existing `apiFetch` helper\n- [ ] Returns a single `Todo` object\n- [ ] Throws on 404 or other errors (consistent with existing error handling pattern)\n\n## Files\n- `apps/frontend/src/api/todos.ts` — add `fetchTodo` function","priority":"2","title":"Add fetchTodo API client function","type":"task"}}
{"type":"create","timestamp":"2026-02-05T22:32:51.454107Z","issue_id":"martian-todos-54f","payload":{"description":"## Context\nNeed a new component to render the detail view for a single todo. This is the main deliverable of the epic.\n\n## Acceptance Criteria\n- [ ] New file `apps/frontend/src/components/TodoDetailView.tsx`\n- [ ] Reads the `:id` param from the URL (via `useParams` from react-router-dom)\n- [ ] Fetches the todo using `fetchTodo` on mount (requires auth token from `useAuth`)\n- [ ] Displays all todo fields: title, description, priority, status, due date, createdAt, updatedAt\n- [ ] Shows a loading skeleton while the fetch is in-flight\n- [ ] Shows a \"Todo not found\" message with a link back to `/` if the fetch returns 404\n- [ ] Shows a generic error message with retry button on other fetch failures\n- [ ] Includes a \"Back to list\" link that navigates to `/`\n- [ ] Uses existing CSS classes/patterns from the app (card, badge, chip, muted, etc.)\n- [ ] Accessible: semantic HTML, aria labels where appropriate\n\n## Files\n- `apps/frontend/src/components/TodoDetailView.tsx` — new component\n- `apps/frontend/src/App.tsx` — register as route target for `/todos/:id`\n\n## Dependencies\n- Requires React Router to be configured (martian-todos-489)\n- Requires `fetchTodo` API function (martian-todos-7fe)","priority":"2","title":"Create TodoDetailView component","type":"task"}}
{"type":"create","timestamp":"2026-02-05T22:33:00.938209Z","issue_id":"martian-todos-6e0","payload":{"description":"## Context\n`TodoItem` (`apps/frontend/src/components/TodoItem.tsx`) currently renders each todo as an `\u003carticle\u003e` with a checkbox and delete button. There is no click handler or link to navigate to a detail view. The title (`\u003ch3\u003e`) should become a clickable link.\n\n## Acceptance Criteria\n- [ ] Todo title in `TodoItem` is wrapped in a `\u003cLink to={/todos/{todo.id}}\u003e` (from react-router-dom)\n- [ ] Clicking the title navigates to the detail view; URL updates to `/todos/:id`\n- [ ] Clicking the checkbox or delete button does NOT trigger navigation (event handling is isolated)\n- [ ] The link is styled consistently with the current title appearance (no default link underline in normal state; underline on hover is acceptable)\n- [ ] Link has appropriate `aria-label` for accessibility\n- [ ] The overall `\u003carticle\u003e` does NOT become a click target — only the title is the navigation trigger (avoids accidental navigation from checkbox/delete clicks)\n\n## Files\n- `apps/frontend/src/components/TodoItem.tsx` — wrap title in Link\n- `apps/frontend/src/index.css` — add/adjust styles if needed for the link\n\n## Dependencies\n- Requires React Router to be configured (martian-todos-489)","priority":"2","title":"Make todo items navigable to detail view","type":"task"}}
{"type":"create","timestamp":"2026-02-05T22:33:09.708242Z","issue_id":"martian-todos-f72","payload":{"description":"## Context\nThe detail view should support editing mutable todo fields directly, using the existing `updateTodo` API function. This is the interactive part of the detail view.\n\n## Acceptance Criteria\n- [ ] Title is editable: click-to-edit or always-editable input field\n- [ ] Description is editable: textarea or click-to-edit\n- [ ] Priority is editable: dropdown or segmented control (low/medium/high)\n- [ ] Status is editable: dropdown or segmented control (pending/in_progress/completed)\n- [ ] Due date is editable: date input (nullable — user can clear it)\n- [ ] Changes are saved via `updateTodo` API call with optimistic UI feedback\n- [ ] Shows syncing indicator while save is in-flight (consistent with list view pattern)\n- [ ] Shows error message if save fails, with option to retry\n- [ ] Read-only fields (id, createdAt, updatedAt) are displayed but not editable\n\n## Files\n- `apps/frontend/src/components/TodoDetailView.tsx` — add editing UI and state management\n- `apps/frontend/src/api/todos.ts` — uses existing `updateTodo`\n\n## Dependencies\n- Requires TodoDetailView component to exist (martian-todos-54f)","priority":"2","title":"Add inline editing to detail view","type":"task"}}
{"type":"create","timestamp":"2026-02-05T22:33:18.580195Z","issue_id":"martian-todos-914","payload":{"description":"## Context\nThe detail view needs CSS styling consistent with the existing app design system. The app uses a custom CSS approach (no framework) with classes like card, badge, chip, button-ghost, button-secondary, muted, etc.\n\n## Acceptance Criteria\n- [ ] Detail view layout: centered card with comfortable reading width (consistent with existing card--soft pattern)\n- [ ] Back link styled as a subtle navigation element (not a primary button)\n- [ ] Field labels and values have clear visual hierarchy\n- [ ] Edit controls (inputs, selects, textarea) match existing form styling from AddTodoForm\n- [ ] Loading skeleton matches the style of TodoList skeleton\n- [ ] 404/error states are styled consistently with existing alert pattern\n- [ ] Responsive: detail view works on mobile widths\n\n## Files\n- `apps/frontend/src/index.css` — add detail view styles\n\n## Dependencies\n- Requires TodoDetailView component to exist (martian-todos-54f)","priority":"2","title":"Add detail view styles","type":"task"}}
{"type":"create","timestamp":"2026-02-05T22:33:27.904464Z","issue_id":"martian-todos-122","payload":{"description":"## Scope\n\nImplement a navigable detail view for individual todos. Clicking a todo in the list navigates to a dedicated detail page at \\`/todos/:id\\` that displays all todo fields and supports inline editing. The URL is shareable/bookmarkable.\n\nReplaces martian-todos-d24 (original bug report, which could not be retitled via pb).\n\n## UX\n\n- **List → Detail**: Clicking a todo title in the list navigates to \\`/todos/:id\\`. The URL updates in the browser.\n- **Detail View**: Shows all todo fields (title, description, priority, status, due date, timestamps). Provides inline editing for mutable fields (title, description, priority, status, due date). Shows a back link to return to the list.\n- **Navigation**: Browser back/forward works. Direct URL access (deep link) loads the correct todo.\n- **Error states**: 404 if the todo doesn't exist. Loading skeleton while fetching.\n\n## Non-goals\n\n- Nested routing (e.g., /todos/:id/comments)\n- Activity history or audit log on the detail view\n- Real-time updates / websocket sync\n- Rewriting the existing list view","priority":"2","title":"Todo Detail View","type":"epic"}}
{"type":"comment","timestamp":"2026-02-05T22:33:32.894996Z","issue_id":"martian-todos-d24","payload":{"body":"Superseded by epic martian-todos-122 (Todo Detail View). Closing this issue — the original bug report has been promoted to a full epic with subtasks."}}
{"type":"close","timestamp":"2026-02-05T22:33:32.921695Z","issue_id":"martian-todos-d24","payload":{}}
{"type":"rename","timestamp":"2026-02-05T22:33:42.938146Z","issue_id":"martian-todos-489","payload":{"new_id":"martian-todos-122.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:42.938146Z","issue_id":"martian-todos-122.1","payload":{"dep_type":"parent-child","depends_on":"martian-todos-122"}}
{"type":"rename","timestamp":"2026-02-05T22:33:42.965861Z","issue_id":"martian-todos-7fe","payload":{"new_id":"martian-todos-122.2"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:42.965861Z","issue_id":"martian-todos-122.2","payload":{"dep_type":"parent-child","depends_on":"martian-todos-122"}}
{"type":"rename","timestamp":"2026-02-05T22:33:42.99452Z","issue_id":"martian-todos-54f","payload":{"new_id":"martian-todos-122.3"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:42.99452Z","issue_id":"martian-todos-122.3","payload":{"dep_type":"parent-child","depends_on":"martian-todos-122"}}
{"type":"rename","timestamp":"2026-02-05T22:33:43.023316Z","issue_id":"martian-todos-6e0","payload":{"new_id":"martian-todos-122.4"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:43.023316Z","issue_id":"martian-todos-122.4","payload":{"dep_type":"parent-child","depends_on":"martian-todos-122"}}
{"type":"rename","timestamp":"2026-02-05T22:33:43.056888Z","issue_id":"martian-todos-f72","payload":{"new_id":"martian-todos-122.5"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:43.056888Z","issue_id":"martian-todos-122.5","payload":{"dep_type":"parent-child","depends_on":"martian-todos-122"}}
{"type":"rename","timestamp":"2026-02-05T22:33:43.096588Z","issue_id":"martian-todos-914","payload":{"new_id":"martian-todos-122.6"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:43.096588Z","issue_id":"martian-todos-122.6","payload":{"dep_type":"parent-child","depends_on":"martian-todos-122"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:48.725426Z","issue_id":"martian-todos-122","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:48.761884Z","issue_id":"martian-todos-122","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.2"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:48.799572Z","issue_id":"martian-todos-122","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.3"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:48.833547Z","issue_id":"martian-todos-122","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.4"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:48.872405Z","issue_id":"martian-todos-122","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.5"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:48.906813Z","issue_id":"martian-todos-122","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.6"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:54.282287Z","issue_id":"martian-todos-122.3","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:54.323218Z","issue_id":"martian-todos-122.3","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.2"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:54.359824Z","issue_id":"martian-todos-122.4","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:54.394323Z","issue_id":"martian-todos-122.5","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.3"}}
{"type":"dep_add","timestamp":"2026-02-05T22:33:54.435766Z","issue_id":"martian-todos-122.6","payload":{"dep_type":"blocks","depends_on":"martian-todos-122.3"}}
{"type":"create","timestamp":"2026-02-05T22:45:14.402482Z","issue_id":"martian-todos-10a","payload":{"description":"Backend endpoints exist in \\: POST /auth/register, /auth/login, /auth/refresh, /auth/logout. Frontend currently persists only access token + user in localStorage via \\ and never uses \\ from \\.\\n\\nGoal: implement end-to-end refresh-token session management in the frontend, including server-side logout (revoking refresh token session) and automatic access-token refresh when requests fail due to expiry.\\n\\nAcceptance criteria:\\n- After login/register, client stores refresh-token session per chosen strategy.\\n- On an authenticated request that receives 401 UNAUTHORIZED due to expired access token, client calls /auth/refresh exactly once, updates auth state, retries the original request, and returns the successful result (or surfaces the original error if refresh fails).\\n- Clicking “Sign Out” revokes the refresh-token session via /auth/logout and clears client auth state.\\n- If refresh fails (invalid/revoked/expired), client clears auth state and returns user to login UI.","priority":"2","title":"Wire up refresh-token auth + logout","type":"epic"}}
{"type":"update","timestamp":"2026-02-05T22:45:46.22691Z","issue_id":"martian-todos-10a","payload":{"description":"Backend endpoints exist in `apps/backend/src/routes/auth.ts`: POST /auth/register, /auth/login, /auth/refresh, /auth/logout. Frontend currently persists only access token + user in localStorage via `apps/frontend/src/hooks/useAuth.ts` and never uses `refreshToken` from `AuthResponse`.\n\nGoal: implement end-to-end refresh-token session management in the frontend, including server-side logout (revoking refresh token session) and automatic access-token refresh when requests fail due to expiry.\n\nAcceptance criteria:\n- After login/register, client stores refresh-token session per chosen strategy.\n- On an authenticated request that receives 401 due to expired access token, client calls /auth/refresh exactly once, updates auth state, retries the original request, and returns the successful result (or surfaces the original error if refresh fails).\n- Clicking “Sign Out” revokes the refresh-token session via /auth/logout and clears client auth state.\n- If refresh fails (invalid/revoked/expired), client clears auth state and returns user to login UI."}}
{"type":"create","timestamp":"2026-02-05T22:46:11.818158Z","issue_id":"martian-todos-a6d","payload":{"description":"Decide how the frontend will store/use refresh tokens.\n\nOption A (minimal, faster):\n- Store access token + refreshToken in localStorage.\n- Frontend sends refreshToken in POST bodies to /auth/refresh and /auth/logout.\n- Update `apps/frontend/src/hooks/useAuth.ts` to persist refreshToken and expose it to API layer.\nPros: simplest, minimal backend changes.\nCons: refreshToken accessible to JS; XSS can steal it.\n\nOption B (more secure):\n- Store refresh token in an httpOnly cookie set by backend on login/register/refresh.\n- Frontend uses `credentials: \"include\"` for refresh/logout requests and does NOT keep refreshToken in JS-accessible storage.\n- Backend must be updated to set/clear cookie and accept cookie-based refresh/logout.\nPros: refreshToken not readable by JS.\nCons: requires backend changes; must handle CORS credentials; consider CSRF mitigation (SameSite + potentially CSRF token).\n\nAcceptance criteria:\n- Document the chosen option and rationale in a pb comment on this issue.\n- List exact code changes required (files + high-level steps) for the chosen option.\n- If Option B chosen, confirm local dev/prod cookie + CORS assumptions (domains, HTTPS, SameSite/Secure).","priority":"2","title":"Decision: refresh token storage strategy","type":"task"}}
{"type":"rename","timestamp":"2026-02-05T22:46:14.742916Z","issue_id":"martian-todos-a6d","payload":{"new_id":"martian-todos-10a.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:46:14.742916Z","issue_id":"martian-todos-10a.1","payload":{"dep_type":"parent-child","depends_on":"martian-todos-10a"}}
{"type":"create","timestamp":"2026-02-05T22:46:20.398311Z","issue_id":"martian-todos-eae","payload":{"description":"Update `apps/frontend/src/hooks/useAuth.ts` to support refresh-token sessions.\n\nImplementation notes:\n- Option A: add a `REFRESH_TOKEN_KEY` localStorage entry; store/clear it alongside access token + user; expose `refreshToken` in hook return value.\n- Option B: do not store refreshToken in JS; still track access token + user; add a boolean like `hasRefreshSession` if needed to drive UI behavior.\n\nAcceptance criteria:\n- After login/register, auth state includes everything needed for refresh/logout flows per the chosen option.\n- Logging out clears access token, user, and refresh-session state.\n- No changes to unrelated auth behavior/UI.","priority":"2","title":"Frontend: persist refresh-token session in useAuth","type":"task"}}
{"type":"rename","timestamp":"2026-02-05T22:46:23.738412Z","issue_id":"martian-todos-eae","payload":{"new_id":"martian-todos-10a.2"}}
{"type":"dep_add","timestamp":"2026-02-05T22:46:23.738412Z","issue_id":"martian-todos-10a.2","payload":{"dep_type":"parent-child","depends_on":"martian-todos-10a"}}
{"type":"create","timestamp":"2026-02-05T22:46:29.604268Z","issue_id":"martian-todos-3fb","payload":{"description":"Extend `apps/frontend/src/api/auth.ts` with refresh/logout helpers.\n\nScope:\n- Add `refresh()` calling POST `/api/auth/refresh`.\n- Add `logout()` calling POST `/api/auth/logout`.\n- Option A: send `{ refreshToken }` body (uses `RefreshTokenInput` from `@martian-todos/shared`).\n- Option B: send no body (or ignore body) but ensure `credentials: \"include\"` and cookie-based auth is supported.\n\nAcceptance criteria:\n- Functions return typed results (`AuthResponse` for refresh; `void` for logout w/ 204 handling).\n- Errors surface useful messages consistent with existing login/register behavior.\n- No new dependencies.","priority":"2","title":"Frontend: add /auth/refresh + /auth/logout API clients","type":"task"}}
{"type":"rename","timestamp":"2026-02-05T22:46:32.623105Z","issue_id":"martian-todos-3fb","payload":{"new_id":"martian-todos-10a.3"}}
{"type":"dep_add","timestamp":"2026-02-05T22:46:32.623105Z","issue_id":"martian-todos-10a.3","payload":{"dep_type":"parent-child","depends_on":"martian-todos-10a"}}
{"type":"create","timestamp":"2026-02-05T22:46:40.253615Z","issue_id":"martian-todos-ed2","payload":{"description":"Add a single place where authenticated API calls can auto-refresh and retry.\n\nFiles:\n- Likely introduce `apps/frontend/src/api/client.ts` (new) with a fetch wrapper, or minimally extend the existing wrapper in `apps/frontend/src/api/todos.ts`.\n\nBehavior:\n- For a request that receives 401 (expired access token), call /auth/refresh once, update auth state, then retry the original request once.\n- Ensure no infinite loops: only one refresh attempt per request.\n- If refresh fails (401/invalid), clear auth state (force re-login).\n\nAcceptance criteria:\n- Expired access token no longer forces manual reload/sign-in; user experiences a transparent refresh.\n- If refresh token is revoked/expired, app returns to login UI and does not keep retrying.\n- Existing API behavior (errors, 204 handling) remains consistent.","priority":"2","title":"Frontend: auto-refresh access token on 401 + retry once","type":"task"}}
{"type":"rename","timestamp":"2026-02-05T22:46:45.004558Z","issue_id":"martian-todos-ed2","payload":{"new_id":"martian-todos-10a.4"}}
{"type":"dep_add","timestamp":"2026-02-05T22:46:45.004558Z","issue_id":"martian-todos-10a.4","payload":{"dep_type":"parent-child","depends_on":"martian-todos-10a"}}
{"type":"create","timestamp":"2026-02-05T22:46:54.187573Z","issue_id":"martian-todos-d71","payload":{"description":"Update the Sign Out flow to revoke the refresh session on the server and then clear local auth state.\n\nFiles:\n- `apps/frontend/src/App.tsx` (Sign Out button currently calls `logout` from `useAuth`).\n- `apps/frontend/src/hooks/useAuth.ts` (store/clear refresh session data).\n- `apps/frontend/src/api/auth.ts` (new logout client).\n\nBehavior:\n- Option A: call POST /auth/logout with `{ refreshToken }` then clear auth.\n- Option B: call POST /auth/logout with `credentials: \"include\"` (cookie) then clear auth.\n- If logout API call fails (network), still clear local auth state (best-effort) but consider surfacing an error toast/banner if one exists.\n\nAcceptance criteria:\n- Sign Out revokes refresh session (confirm by attempting refresh after logout and observing 401).\n- UI returns to login screen; localStorage contains no stale tokens (Option A) or access token is cleared (Option B).\n- No new dependencies.","priority":"2","title":"Frontend: wire Sign Out to server logout (revoke refresh token)","type":"task"}}
{"type":"rename","timestamp":"2026-02-05T22:46:57.662292Z","issue_id":"martian-todos-d71","payload":{"new_id":"martian-todos-10a.5"}}
{"type":"dep_add","timestamp":"2026-02-05T22:46:57.662292Z","issue_id":"martian-todos-10a.5","payload":{"dep_type":"parent-child","depends_on":"martian-todos-10a"}}
{"type":"create","timestamp":"2026-02-05T22:47:07.287203Z","issue_id":"martian-todos-859","payload":{"description":"Only needed if the decision task chooses Option B.\n\nBackend changes:\n- On /auth/register and /auth/login: set refresh token in an httpOnly cookie and omit `refreshToken` from JSON (or leave it but prefer cookie).\n- On /auth/refresh: read refresh token from cookie; (optional) rotate cookie value if we implement rotation.\n- On /auth/logout: read refresh token from cookie, revoke session, clear cookie.\n\nFiles:\n- `apps/backend/src/routes/auth.ts`\n- Any CORS/fastify config that governs cookies/credentials.\n\nSecurity notes:\n- Cookie flags: HttpOnly; Secure in prod; SameSite Lax (or Strict if compatible); Path=/; consider domain.\n- With cross-site frontend/backend origins, configure CORS to allow credentials.\n\nAcceptance criteria:\n- Refresh/logout succeed without any refreshToken in JS.\n- Refresh token cookie is not readable via JS.\n- Local dev flow documented (what origin(s) are used and how CORS/credentials behave).","priority":"2","title":"Backend (if Option B): move refresh token to httpOnly cookie","type":"task"}}
{"type":"rename","timestamp":"2026-02-05T22:47:11.340764Z","issue_id":"martian-todos-859","payload":{"new_id":"martian-todos-10a.6"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:11.340764Z","issue_id":"martian-todos-10a.6","payload":{"dep_type":"parent-child","depends_on":"martian-todos-10a"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:32.98255Z","issue_id":"martian-todos-10a","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.027971Z","issue_id":"martian-todos-10a","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.2"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.07116Z","issue_id":"martian-todos-10a","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.3"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.118027Z","issue_id":"martian-todos-10a","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.4"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.165987Z","issue_id":"martian-todos-10a","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.5"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.218606Z","issue_id":"martian-todos-10a","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.6"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.27277Z","issue_id":"martian-todos-10a.2","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.332129Z","issue_id":"martian-todos-10a.3","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.416992Z","issue_id":"martian-todos-10a.4","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.489975Z","issue_id":"martian-todos-10a.5","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.562791Z","issue_id":"martian-todos-10a.6","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.1"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.626891Z","issue_id":"martian-todos-10a.4","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.3"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.690513Z","issue_id":"martian-todos-10a.4","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.2"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.751316Z","issue_id":"martian-todos-10a.5","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.3"}}
{"type":"dep_add","timestamp":"2026-02-05T22:47:33.808508Z","issue_id":"martian-todos-10a.5","payload":{"dep_type":"blocks","depends_on":"martian-todos-10a.2"}}
{"type":"status_update","timestamp":"2026-02-05T22:50:34.946303Z","issue_id":"martian-todos-122.1","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-05T22:50:35.529404Z","issue_id":"martian-todos-122.2","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-05T22:52:15.621923Z","issue_id":"martian-todos-122.2","payload":{}}
{"type":"close","timestamp":"2026-02-05T22:55:31.544296Z","issue_id":"martian-todos-122.1","payload":{}}
